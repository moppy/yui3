YUI.add("history-base",function(B){var I=B.Lang,E=B.Object,L=YUI.namespace("Env.History"),M=B.Array,F=B.config.doc.documentMode,J=B.config.win,C={merge:true},H="change",A="add",G="replace";function D(){this._init.apply(this,arguments);}B.augment(D,B.EventTarget,null,null,{emitFacade:true,prefix:"history",preventable:false,queueable:true});if(!L._state){L._state={};}function K(N){return I.type(N)==="object";}D.NAME="historyBase";D.SRC_ADD=A;D.SRC_REPLACE=G;D.html5=!!(J.history&&J.history.pushState&&J.history.replaceState&&("onpopstate" in J||B.UA.gecko>=2));D.nativeHashChange="onhashchange" in J&&(!F||F>7);B.mix(D.prototype,{_init:function(O){var N;O=this._config=O||{};N=this._initialState=this._initialState||O.initialState||null;this.publish(H,{broadcast:2,defaultFn:this._defChangeFn});if(N){this.add(N);}},add:function(){var N=M(arguments,0,true);N.unshift(A);return this._change.apply(this,N);},addValue:function(O,Q,N){var P={};P[O]=Q;return this._change(A,P,N);},get:function(O){var P=L._state,N=K(P);if(O){return N&&E.owns(P,O)?P[O]:undefined;}else{return N?B.mix({},P,true):P;}},replace:function(){var N=M(arguments,0,true);N.unshift(G);return this._change.apply(this,N);},replaceValue:function(O,Q,N){var P={};P[O]=Q;return this._change(G,P,N);},_change:function(P,O,N){N=N?B.merge(C,N):C;if(N.merge&&K(O)&&K(L._state)){O=B.merge(L._state,O);}this._resolveChanges(P,O,N);return this;},_fireEvents:function(P,O,N){this.fire(H,{_options:N,changed:O.changed,newVal:O.newState,prevVal:O.prevState,removed:O.removed,src:P});E.each(O.changed,function(R,Q){this._fireChangeEvent(P,Q,R);},this);E.each(O.removed,function(R,Q){this._fireRemoveEvent(P,Q,R);},this);},_fireChangeEvent:function(P,N,O){this.fire(N+"Change",{newVal:O.newVal,prevVal:O.prevVal,src:P});},_fireRemoveEvent:function(P,N,O){this.fire(N+"Remove",{prevVal:O,src:P});},_resolveChanges:function(T,R,O){var S={},N,Q=L._state,P={};if(!R){R={};}if(!O){O={};}if(K(R)&&K(Q)){E.each(R,function(U,V){var W=Q[V];if(U!==W){S[V]={newVal:U,prevVal:W};N=true;}},this);E.each(Q,function(V,U){if(!E.owns(R,U)||R[U]===null){delete R[U];P[U]=V;N=true;}},this);}else{N=R!==Q;}if(N){this._fireEvents(T,{changed:S,newState:R,prevState:Q,removed:P},O);}},_storeState:function(O,N){L._state=N||{};},_defChangeFn:function(N){this._storeState(N.src,N.newVal,N._options);}},true);B.HistoryBase=D;},"@VERSION@",{requires:["event-custom-complex"]});